<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Value Chain Builder - Fin AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1f8ceb 0%, #7b68ee 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 24px 48px rgba(31, 140, 235, 0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1f8ceb 0%, #2d5aa0 100%);
            color: white;
            padding: 32px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 400;
        }

        .game-instructions {
            background: #f7f8fa;
            padding: 24px 32px;
            border-bottom: 1px solid #e1e5e9;
            text-align: center;
        }

        .instructions-text {
            color: #425a72;
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .chain-example {
            display: inline-flex;
            align-items: center;
            background: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(31, 140, 235, 0.1);
            font-weight: 600;
            color: #1f8ceb;
        }

        .arrow {
            margin: 0 12px;
            color: #06d6a0;
            font-size: 1.2rem;
        }

        .game-area {
            padding: 32px;
        }

        .chains-container {
            display: flex;
            flex-direction: column;
            gap: 24px;
            margin-bottom: 32px;
        }

        .value-chain {
            background: #f8fafc;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr auto 1fr auto 1fr;
            gap: 16px;
            align-items: center;
            position: relative;
            transition: all 0.3s ease;
        }

        .value-chain.complete {
            border-color: #06d6a0;
            background: linear-gradient(135deg, #d1f2eb 0%, #f0fdfa 100%);
            box-shadow: 0 4px 12px rgba(6, 214, 160, 0.2);
        }

        .chain-step {
            text-align: center;
        }

        .step-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #425a72;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .drop-zone {
            min-height: 100px;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 12px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #64748b;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            line-height: 1.3;
        }

        .drop-zone.drag-over {
            border-color: #1f8ceb;
            background: #eef2ff;
            transform: scale(1.02);
        }

        .drop-zone.filled {
            background: #e0f2fe;
            border-color: #1f8ceb;
            color: #0c4a6e;
            font-weight: 500;
        }

        .chain-arrow {
            font-size: 1.5rem;
            color: #06d6a0;
            font-weight: bold;
        }

        .items-pool {
            background: #f7f8fa;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .pool-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
            text-align: center;
        }

        .pool-section {
            margin-bottom: 20px;
        }

        .pool-label {
            font-size: 1rem;
            font-weight: 600;
            color: #425a72;
            margin-bottom: 12px;
            padding: 8px 12px;
            background: white;
            border-radius: 6px;
            display: inline-block;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
        }

        .draggable-item {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            cursor: grab;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            font-weight: 500;
            line-height: 1.4;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }

        .draggable-item:hover {
            border-color: #1f8ceb;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(31, 140, 235, 0.15);
        }

        .draggable-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
            z-index: 1000;
        }

        .draggable-item.used {
            opacity: 0.3;
            cursor: not-allowed;
            background: #f1f5f9;
        }

        .feature-item {
            border-left: 4px solid #1f8ceb;
        }

        .value-item {
            border-left: 4px solid #f59e0b;
        }

        .metric-item {
            border-left: 4px solid #06d6a0;
        }

        .controls {
            text-align: center;
            margin-top: 32px;
        }

        .score-display {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2d3436;
            margin-bottom: 24px;
        }

        .btn {
            background: linear-gradient(135deg, #1f8ceb 0%, #7b68ee 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin: 0 8px;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(31, 140, 235, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(31, 140, 235, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-success {
            background: linear-gradient(135deg, #06d6a0 0%, #00b894 100%);
            box-shadow: 0 4px 12px rgba(6, 214, 160, 0.2);
        }

        .btn-success:hover {
            box-shadow: 0 8px 20px rgba(6, 214, 160, 0.3);
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 48px;
            border-radius: 16px;
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.2);
            text-align: center;
            z-index: 1000;
            display: none;
            max-width: 500px;
            border: 2px solid #06d6a0;
        }

        .celebration h2 {
            color: #06d6a0;
            margin-bottom: 16px;
            font-size: 2rem;
        }

        .celebration p {
            color: #425a72;
            margin-bottom: 24px;
            font-size: 1.1rem;
            line-height: 1.5;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(45, 52, 54, 0.8);
            z-index: 999;
            display: none;
        }

        .completion-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #06d6a0;
            color: white;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(6, 214, 160, 0.3);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .pulse {
            animation: pulse 0.6s ease;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .game-container {
                margin: 0;
                border-radius: 12px;
            }
            
            .header {
                padding: 20px 16px;
            }
            
            .header h1 {
                font-size: 1.8rem;
                margin-bottom: 6px;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .game-instructions {
                padding: 16px;
            }
            
            .instructions-text {
                font-size: 1rem;
                margin-bottom: 10px;
            }
            
            .chain-example {
                flex-direction: column;
                padding: 12px 16px;
                font-size: 0.9rem;
            }
            
            .arrow {
                transform: rotate(90deg);
                margin: 4px 0;
            }
            
            .game-area {
                padding: 16px;
            }
            
            .chains-container {
                gap: 16px;
                margin-bottom: 24px;
            }
            
            .value-chain {
                display: flex;
                flex-direction: column;
                gap: 12px;
                padding: 16px;
            }
            
            .chain-arrow {
                transform: rotate(90deg);
                margin: 4px 0;
            }
            
            .drop-zone {
                min-height: 120px;
                padding: 16px;
                font-size: 0.85rem;
            }
            
            .items-pool {
                padding: 16px;
                margin-bottom: 24px;
            }
            
            .pool-title {
                font-size: 1.1rem;
                margin-bottom: 12px;
            }
            
            .pool-section {
                margin-bottom: 16px;
            }
            
            .items-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 10px;
            }
            
            .draggable-item {
                min-height: 100px;
                padding: 16px 12px;
                font-size: 0.85rem;
                cursor: pointer;
            }
            
            .draggable-item:active {
                transform: scale(0.95);
                background: #f1f5f9;
            }
            
            .btn {
                padding: 14px 20px;
                margin: 4px;
                font-size: 0.9rem;
                display: block;
                width: 100%;
                max-width: 200px;
                margin: 8px auto;
            }
            
            .controls {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            
            .celebration {
                max-width: 90%;
                padding: 32px 20px;
                margin: 20px;
            }
            
            .celebration h2 {
                font-size: 1.6rem;
                margin-bottom: 12px;
            }
            
            .celebration p {
                font-size: 1rem;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>🔗 Value Chain Builder</h1>
            <p>Connect Fin AI features to their business value and measurable impact</p>
        </div>

        <div class="game-instructions">
            <div class="instructions-text">
                Drag and drop to build complete value chains showing how features drive business outcomes
            </div>
            <div class="chain-example">
                Feature <span class="arrow">→</span> Business Value <span class="arrow">→</span> Metrics Impact
            </div>
        </div>

        <div class="game-area">
            <div class="chains-container" id="chains-container">
                <!-- Value chains will be populated here -->
            </div>

            <div class="items-pool">
                <div class="pool-title">🧩 Drag these pieces to build your value chains</div>
                
                <div class="pool-section">
                    <div class="pool-label">🔧 Features</div>
                    <div class="items-grid" id="features-pool">
                        <!-- Features will be populated here -->
                    </div>
                </div>

                <div class="pool-section">
                    <div class="pool-label">💡 Business Values</div>
                    <div class="items-grid" id="values-pool">
                        <!-- Values will be populated here -->
                    </div>
                </div>

                <div class="pool-section">
                    <div class="pool-label">📊 Metrics Impact</div>
                    <div class="items-grid" id="metrics-pool">
                        <!-- Metrics will be populated here -->
                    </div>
                </div>
            </div>

            <div class="controls">
                <div class="score-display">
                    Completed Chains: <span id="score">0</span> of <span id="total-chains">5</span>
                </div>
                <button class="btn" onclick="checkAllChains()">🔍 Validate Chains</button>
                <button class="btn" onclick="resetGame()">🔄 Reset Game</button>
                <button class="btn" onclick="showHint()">💡 Hint</button>
            </div>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="celebration" id="celebration">
        <h2>🎉 Value Chain Master!</h2>
        <p id="celebration-text">You've successfully mapped all Fin AI features to their business value and measurable impact!</p>
        <button class="btn btn-success" onclick="restartGame()">Play Again</button>
    </div>

    <script>
        // Game data from your latest PDF table with simplified metrics
        const gameData = [
            {
                id: 1,
                feature: "Customer Experience Score (CX Score)",
                value: "Get your customer's real sentiment, allowing you to personalise their experience, escalate without being asked, understand what type of experience matters to them",
                metrics: "CSAT, NPS"
            },
            {
                id: 2,
                feature: "Multi-source Generative Answers",
                value: "It's as good an experience as talking to a human, except faster, in any language and at any time",
                metrics: "First Contact Resolution Rate, Average Handle Time, Customer Effort Score"
            },
            {
                id: 3,
                feature: "No-code, End-to-End AI Agent Workspace",
                value: "You have full control over making Fin better without relying on dev resources",
                metrics: "Time to Value, Support Team Productivity, Rate of Continuous Improvement"
            },
            {
                id: 4,
                feature: "Easy Omnichannel Deployment",
                value: "Give your customers a homogeneous experience and meet them where they are",
                metrics: "Customer Effort Score, CSAT"
            },
            {
                id: 5,
                feature: "Fin Tasks",
                value: "Outsource repetitive actions to Fin so it stops overwhelming your human team",
                metrics: "Resolution Rate, Average Handle Time, Agent Escalation Rate, CSAT"
            }
        ];

        let completedChains = 0;
        let draggedElement = null;
        let chainStates = {};
        let touchItem = null;
        let touchOffset = { x: 0, y: 0 };

        function initializeGame() {
            console.log('Initializing game...');
            
            // Initialize chain states first
            chainStates = {};
            gameData.forEach(item => {
                chainStates[item.id] = { feature: null, value: null, metrics: null };
            });
            
            console.log('Initial chain states:', chainStates);
            
            createValueChains();
            populateItemPools();
            updateScore();
            initializeDragAndDrop();
        }

        function createValueChains() {
            const container = document.getElementById('chains-container');
            container.innerHTML = '';

            gameData.forEach((item, index) => {
                const chain = document.createElement('div');
                chain.className = 'value-chain';
                chain.dataset.chainId = item.id;
                chain.innerHTML = `
                    <div class="chain-step">
                        <div class="step-label">Feature</div>
                        <div class="drop-zone" data-type="feature" data-chain="${item.id}">
                            Drop feature here
                        </div>
                    </div>
                    <div class="chain-arrow">→</div>
                    <div class="chain-step">
                        <div class="step-label">Business Value</div>
                        <div class="drop-zone" data-type="value" data-chain="${item.id}">
                            Drop business value here
                        </div>
                    </div>
                    <div class="chain-arrow">→</div>
                    <div class="chain-step">
                        <div class="step-label">Metrics Impact</div>
                        <div class="drop-zone" data-type="metrics" data-chain="${item.id}">
                            Drop metrics here
                        </div>
                    </div>
                `;
                container.appendChild(chain);
                
                // Initialize chain state
                chainStates[item.id] = { feature: null, value: null, metrics: null };
            });
        }

        function populateItemPools() {
            const featuresPool = document.getElementById('features-pool');
            const valuesPool = document.getElementById('values-pool');
            const metricsPool = document.getElementById('metrics-pool');

            featuresPool.innerHTML = '';
            valuesPool.innerHTML = '';
            metricsPool.innerHTML = '';

            // Create arrays of features, values, and metrics
            const features = gameData.map(item => ({ ...item, type: 'feature' }));
            const values = gameData.map(item => ({ ...item, type: 'value' }));
            const metrics = gameData.map(item => ({ ...item, type: 'metrics' }));

            // Shuffle each array independently for maximum randomization
            const shuffledFeatures = features.sort(() => Math.random() - 0.5);
            const shuffledValues = values.sort(() => Math.random() - 0.5);
            const shuffledMetrics = metrics.sort(() => Math.random() - 0.5);

            // Add features in random order
            shuffledFeatures.forEach(item => {
                const featureItem = document.createElement('div');
                featureItem.className = 'draggable-item feature-item';
                featureItem.draggable = true;
                featureItem.dataset.type = 'feature';
                featureItem.dataset.chainId = item.id;
                featureItem.textContent = item.feature;
                featuresPool.appendChild(featureItem);
            });

            // Add values in different random order
            shuffledValues.forEach(item => {
                const valueItem = document.createElement('div');
                valueItem.className = 'draggable-item value-item';
                valueItem.draggable = true;
                valueItem.dataset.type = 'value';
                valueItem.dataset.chainId = item.id;
                valueItem.textContent = item.value;
                valuesPool.appendChild(valueItem);
            });

            // Add metrics in another different random order
            shuffledMetrics.forEach(item => {
                const metricsItem = document.createElement('div');
                metricsItem.className = 'draggable-item metric-item';
                metricsItem.draggable = true;
                metricsItem.dataset.type = 'metrics';
                metricsItem.dataset.chainId = item.id;
                metricsItem.textContent = item.metrics;
                metricsPool.appendChild(metricsItem);
            });
        }

        function initializeDragAndDrop() {
            // Add drag events to all draggable items
            document.querySelectorAll('.draggable-item').forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                
                // Touch events for mobile
                item.addEventListener('touchstart', handleTouchStart, { passive: false });
                item.addEventListener('touchmove', handleTouchMove, { passive: false });
                item.addEventListener('touchend', handleTouchEnd, { passive: false });
            });

            // Add drop events to all drop zones
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('drop', handleDrop);
                zone.addEventListener('dragleave', handleDragLeave);
            });
        }

        function handleDragStart(e) {
            draggedElement = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.setData('text/plain', '');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedElement = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.target.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.target.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');

            if (!draggedElement) return;

            handleDropLogic(e.target, draggedElement);
        }

        function handleTouchStart(e) {
            if (e.target.classList.contains('used')) return;
            
            touchItem = e.target;
            const touch = e.touches[0];
            const rect = e.target.getBoundingClientRect();
            touchOffset = {
                x: touch.clientX - rect.left,
                y: touch.clientY - rect.top
            };
            
            e.target.classList.add('dragging');
            e.preventDefault();
        }

        function handleTouchMove(e) {
            if (!touchItem) return;
            
            e.preventDefault();
            const touch = e.touches[0];
            
            // Move the item with the finger
            touchItem.style.position = 'fixed';
            touchItem.style.left = (touch.clientX - touchOffset.x) + 'px';
            touchItem.style.top = (touch.clientY - touchOffset.y) + 'px';
            touchItem.style.zIndex = '1000';
            touchItem.style.pointerEvents = 'none';
            
            // Find drop zone under finger
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            const dropZone = elementBelow?.closest('.drop-zone');
            
            // Highlight drop zones
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('drag-over');
            });
            
            if (dropZone) {
                dropZone.classList.add('drag-over');
            }
        }

        function handleTouchEnd(e) {
            if (!touchItem) return;
            
            const touch = e.changedTouches[0];
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            const dropZone = elementBelow?.closest('.drop-zone');
            
            // Reset item position
            touchItem.style.position = '';
            touchItem.style.left = '';
            touchItem.style.top = '';
            touchItem.style.zIndex = '';
            touchItem.style.pointerEvents = '';
            touchItem.classList.remove('dragging');
            
            // Clear drag over states
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('drag-over');
            });
            
            // Handle drop if over a valid zone
            if (dropZone) {
                handleDropLogic(dropZone, touchItem);
            }
            
            touchItem = null;
        }

        function handleDropLogic(dropZone, draggedItem) {
            const dropType = dropZone.dataset.type;
            const dropChainId = dropZone.dataset.chain;
            const dragType = draggedItem.dataset.type;
            const dragChainId = draggedItem.dataset.chainId;

            // Check if types match
            if (dropType !== dragType) {
                return;
            }

            // Clear previous content if any
            const existingItem = dropZone.querySelector('.dropped-item');
            if (existingItem) {
                // Return previous item to pool
                const originalItem = document.querySelector(`[data-chain-id="${existingItem.dataset.chainId}"][data-type="${dropType}"]`);
                if (originalItem) {
                    originalItem.classList.remove('used');
                    originalItem.draggable = true;
                }
            }
            
            dropZone.innerHTML = '';
            
            // Clone the dragged element for the drop zone
            const clonedElement = draggedItem.cloneNode(true);
            clonedElement.classList.remove('dragging', 'draggable-item');
            clonedElement.classList.add('dropped-item');
            clonedElement.draggable = false;
            clonedElement.dataset.chainId = dragChainId;
            
            dropZone.appendChild(clonedElement);
            dropZone.classList.add('filled');

            // Update chain state
            chainStates[dropChainId][dropType] = dragChainId;

            // Mark original as used
            draggedItem.classList.add('used');
            draggedItem.draggable = false;

            // Check if chain is complete and correct
            checkChainCompletion(dropChainId);
        }

        function checkChainCompletion(chainId) {
            const chain = chainStates[chainId];
            const isComplete = chain.feature && chain.value && chain.metrics;
            const isCorrect = chain.feature === chainId.toString() && 
                            chain.value === chainId.toString() && 
                            chain.metrics === chainId.toString();

            if (isComplete && isCorrect) {
                const chainElement = document.querySelector(`[data-chain-id="${chainId}"]`);
                chainElement.classList.add('complete', 'pulse');
                
                // Add completion badge
                if (!chainElement.querySelector('.completion-badge')) {
                    const badge = document.createElement('div');
                    badge.className = 'completion-badge';
                    badge.textContent = '✓';
                    chainElement.appendChild(badge);
                }

                setTimeout(() => chainElement.classList.remove('pulse'), 600);
                updateScore();
            }
        }

        function updateScore() {
            completedChains = Object.values(chainStates).filter(chain => {
                const chainId = Object.keys(chainStates).find(key => chainStates[key] === chain);
                return chain.feature && chain.value && chain.metrics &&
                       chain.feature === chain.value && chain.value === chain.metrics;
            }).length;

            document.getElementById('score').textContent = completedChains;
            document.getElementById('total-chains').textContent = gameData.length;

            if (completedChains === gameData.length) {
                setTimeout(showCelebration, 1000);
            }
        }

        function checkAllChains() {
            let feedback = "Chain Validation Results:\n\n";
            let allCorrect = true;

            gameData.forEach(item => {
                const chain = chainStates[item.id];
                const isComplete = chain.feature && chain.value && chain.metrics;
                const isCorrect = chain.feature === item.id.toString() && 
                                chain.value === item.id.toString() && 
                                chain.metrics === item.id.toString();

                if (isComplete && isCorrect) {
                    feedback += `✅ ${item.feature} - Complete and Correct!\n`;
                } else if (isComplete) {
                    feedback += `❌ ${item.feature} - Complete but incorrect mapping\n`;
                    allCorrect = false;
                } else {
                    feedback += `⏳ ${item.feature} - Incomplete\n`;
                    allCorrect = false;
                }
            });

            if (allCorrect) {
                feedback += "\n🎉 Perfect! All value chains are correctly mapped!";
            } else {
                feedback += "\n💡 Keep working on the incomplete or incorrect chains.";
            }

            alert(feedback);
        }

        function resetGame() {
            chainStates = {};
            completedChains = 0;
            
            // Clear all drop zones
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.innerHTML = zone.dataset.type === 'feature' ? 'Drop feature here' :
                               zone.dataset.type === 'value' ? 'Drop business value here' :
                               'Drop metrics here';
                zone.classList.remove('filled');
            });

            // Reset all draggable items
            document.querySelectorAll('.draggable-item').forEach(item => {
                item.classList.remove('used');
                item.draggable = true;
            });

            // Reset chain styling
            document.querySelectorAll('.value-chain').forEach(chain => {
                chain.classList.remove('complete');
                const badge = chain.querySelector('.completion-badge');
                if (badge) badge.remove();
            });

            // Initialize chain states
            gameData.forEach(item => {
                chainStates[item.id] = { feature: null, value: null, metrics: null };
            });

            updateScore();
        }

        function showHint() {
            const hints = [
                "💡 Look for thematic connections between features and their natural outcomes",
                "🔍 CX Score relates to understanding customer sentiment and satisfaction metrics",
                "🤖 Multi-source Answers improve first contact resolution and response accuracy",
                "⚙️ No-code workspace improves team productivity and deployment speed",
                "📱 Omnichannel ensures consistent experience across all customer touchpoints",
                "🔄 Fin Tasks automate repetitive work to reduce agent workload and escalations"
            ];

            const randomHint = hints[Math.floor(Math.random() * hints.length)];
            alert(randomHint);
        }

        function showCelebration() {
            let message = `Congratulations! You've successfully mapped all ${gameData.length} Fin AI features to their business value and measurable impact!\n\n`;
            message += "🏆 You now understand how Fin AI features directly drive business outcomes and ROI.";
            
            if (completedChains === gameData.length) {
                message += "\n\n🦙🦙🦙 IF YOU'RE DONE FIRST, SHOUT ALPACA TO CLAIM YOUR PRIZE! 🦙🦙🦙";
            }

            document.getElementById('celebration-text').textContent = message;
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('celebration').style.display = 'block';
        }

        function hideCelebration() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('celebration').style.display = 'none';
        }

        function restartGame() {
            hideCelebration();
            resetGame();
            populateItemPools();
            initializeDragAndDrop();
        }

        // Initialize the game when the page loads
        window.addEventListener('load', initializeGame);
    </script>
</body>
</html>
